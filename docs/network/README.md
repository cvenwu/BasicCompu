# 计算机网络

!> **计算机网络** 面试题以及答案整理

## TCP和UDP区别
![1CC069D2-AFAA-4B03-857C-55A53DFF4951](https://cdn.jsdelivr.net/gh/sivanWu0222/ImageHosting@master/uPic/1CC069D2-AFAA-4B03-857C-55A53DFF4951.png)

   |               UDP(User Datagram Protocol)                |              TCP(Transmission Control Protocol)              |
   | :------------------------------------------------------: | :----------------------------------------------------------: |
   |                          无连接                          |                           面向连接                           |
   |          支持一对一，一对多，多对一，多对多通信          | 因为双方需要提前建立连接，因此只能一对一进行全双工通信(全双工：双方随时都可以发送和接收数据) |
   |  面向报文段(对应用层发送的报文段直接添加首部并传送到IP)  |                          面向字节流                          |
   | 不保证可靠交付，尽最大努力交付，不使用流量控制和拥塞控制 | 可靠传输，使用确认序号，滑动窗口，流量控制以及拥塞控制等来实现可靠传输 |
   |                      首部只有8字节                       |               首部最小有20字节，最大有60字节               |

## OSI 7层协议 与 五层协议 与4层协议
![IG3irM](https://cdn.jsdelivr.net/gh/sivanWu0222/ImageHosting@master/uPic/IG3irM.png)

### OSI 7层协议：
1. 应用层 ：为特定应用程序提供数据传输服务，例如 HTTP、DNS 等协议。数据单位为报文。 
2. 表示层 ：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题。 
3. 会话层 ：建立及管理会话。
4. 传输层 ：为进程提供通用数据传输服务。由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的 应用层协议。运输层包括两种协议：传输控制协议 TCP，提供面向连接、可靠的数据传输服务，数据单位为报 文段；用户数据报协议 UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。TCP 主要提 供完整性服务，UDP 主要提供及时性服务。 
5. 网络层 ：为主机提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务。网络层把传输层传递 下来的报文段或者用户数据报封装成分组。 
6. 数据链路层 ：网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为同 一链路的主机提供数据传输服务。数据链路层把网络层传下来的分组封装成帧。 
7. 物理层 ：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽 传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。

### 5层协议

!> 只是在7层协议上去掉会话层与表示层

### 4层协议
1. 它只有四层，相当于五层协议中数据链路层和物理层合并为网络接口层。
2. TCP/IP 体系结构不严格遵循 OSI 分层概念，应用层可能会直接使用 IP 层或者网络接口层。
![epxWaK](https://cdn.jsdelivr.net/gh/sivanWu0222/ImageHosting@master/uPic/epxWaK.png)

!> 注意：路由器只有下面三层协议，因为路由器位于网络核心中，不需要为进程或者应用程序提供服务，因此也就不需要传输 层和应用层。


## 路由器、防火墙处于哪一层
1. 路由器：网络层
2. 防火墙：工作在网络层，传输层，应用层，取决于防火墙的种类
    2.1 过滤型防火墙: 过滤型防火墙是在网络层与传输层中，可以基于数据源头的地址以及协议类型等标志特征进行分析，确定是否可以通过。在符合防火墙规定标准之下，满足安全性能以及类型才可以进行信息的传递，而一些不安全的因素则会被防火墙过滤、阻挡。
    2.2 应用代理防火墙：应用代理防火墙主要的工作范围就是在OIS的最高层，位于应用层之上。其主要的特征是可以完全隔离网络通信流，通过特定的代理程序就可以实现对应用层的监督与控制。
    2.3 复合型防火墙技术：目前应用较为广泛的防火墙技术当属复合型防火墙技术，综合了包过滤防火墙技术以及应用代理防火墙技术的优点，譬如发过来的安全策略是包过滤策略，那么可以针对报文的报头部分进行访问控制；如果安全策略是代理策略，就可以针对报文的内容数据进行访问控制，因此复合型防火墙技术综合了其组成部分的优点，同时摒弃了两种防火墙的原有缺点，大大提高了防火墙技术在应用实践中的灵活性和安全性。
3. 交换机：数据链路层

## DNS协议

## TCP可靠性的实现方式
!> TCP 是通过序列号、确认应答、重发控制、连接管理以及窗口控制等机制实现可靠性传输的。

## 计算机在设置ip的时候会设置哪些参数
ip地址，子网掩码，网关地址
进阶问题：说说子网掩码以及网关的作用

## HTTP状态码
1. [官方网站](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)
2. ![jcVmoh](https://cdn.jsdelivr.net/gh/sivanWu0222/ImageHosting@master/uPic/jcVmoh.png)

## HTTP中的请求方法
![Q1BBEG](https://cdn.jsdelivr.net/gh/sivanWu0222/ImageHosting@master/uPic/Q1BBEG.png)

## 一个网页的请求过程
[参考](https://github.com/Bulandent/blog/issues/14)

### 用户输入阶段
1. 合成 URL：用户输入 URL，浏览器会根据用户输入的信息判断是搜索还是网址，如果是搜索内容，就将搜索内容 + 默认搜索引擎合成新的 URL；如果用户输入的内容符合 URL 规则，浏览器就会根据 URL 协议，在这段内容上加上协议合成合法的 URL；
2. 加载：用户输入完内容，按下回车键，浏览器导航栏显示 loading 状态，但是页面还是呈现前一个页面，这是因为新页面的响应数据还没有获得；
### 发起URL请求阶段
1. 构建请求：浏览器进程首先会构建请求行信息，然后通过进程间通信（IPC）将 URL 请求发送给网络进程；
2. 查找缓存：网络进程获取到 URL，先去本地缓存中查找是否有缓存资源，如果有则拦截请求，直接将缓存资源返回给浏览器进程；否则，进入网络请求阶段；
3. DNS 解析：网络进程请求首先会从 DNS 数据缓存服务中查找是否缓存过当前域名信息，有则直接返回；否则，会进行 DNS 解析返回域名对应的 IP 和端口号，如果没有指定端口号，http 默认 80 端口，https 默认 443。如果是 https 请求，还需要建立 TLS 连接；
4. 等待 TCP 队列：Chrome 有个机制，同一个域名同时最多只能建立 6 个 TCP 连接，如果在同一个域名下同时有 10 个请求发生，那么其中 4 个请求会进入排队等待状态，直至进行中的请求完成。如果当前请求数量少于6个，会直接建立 TCP 连接；
5. 建立 TCP 连接：TCP 三次握手与服务器建立连接，然后进行数据的传输，最后；
6. 发送 HTTP 请求：浏览器首先会向服务器发送请求行，它包含了请求方法、请求 URI 和 HTTP 协议的版本；另外还会发送请求头，告诉服务器一些浏览器的相关信息，比如浏览器内核，请求域名、Cookie 等；如果需要传递参数，则还需要发送请求体；
7. 服务器处理请求：服务器首先返回响应行，包括协议版本和状态码，比如状态码 200 表示继续处理该请求；（如果是 301，则表示重定向，将会在响应头的 Locaiton 字段中加上重定向的地址信息，接下来浏览器获取这个地址，将会重新导航。）服务器也会向浏览器发送响应头，包含了一些信息，比如服务器生成返回数据的时间、返回的数据类型（JSON、HTML、流媒体等类型），以及服务器要在客户端保存的 Cookie 等；继续发送响应体的数据；
8. 断开 TCP 连接：数据传输完成，正常情况下 TCP 将四次挥手断开连接。但是如果浏览器或者服务器在HTTP头部加上 Connection: keep-alive，TCP 就会一直保持连接。保持 TCP 连接可以省下下次需要建立连接的时间，提示资源加载速度；
### 准备渲染进程阶段
1. 网络进程将获取到的数据包进行解析，根据响应头中的 Content-type 来判断响应数据的类型，如果是字节流类型，就将该请求交给下载管理器，该导航流程结束，不再进行；如果是 text/html 类型，就通知浏览器进程获取到的是 HTML，应该准备渲染进程了；
2. 正常情况下每个浏览器的 tab 会对应一个渲染进程，但如果从一个页面打开了另一个新页面，而新页面和当前页面属于同一站点的话，那么新页面会复用父页面的渲染进程，否则就会创建一个新的渲染进程；
### 提交文档阶段
1. 渲染进程准备好后，浏览器会发出 “提交文档” 的消息给渲染进程，渲染进程收到消息后，会和网络进程建立传输数据的 “管道”，文档数据传输完成后，渲染进程会返回“确认提交”的消息给浏览器进程；
2. 浏览器收到 “确认提交” 的消息后，会更新浏览器的页面状态，包括了安全状态、地址栏的 URL、前进后退的历史状态，并更新 web 页面，此时的 web 页面是空白页；
### 页面渲染阶段
1. 文档一旦提交，渲染进程将开始页面解析和子资源加载；渲染阶段比较复杂，所以将分为多个子阶段，按照渲染的时间顺序可以分为：构建 DOM 树、样式计算、布局阶段、分层、绘制、分块、光栅化和合成；
2. 构建 DOM 树：HTML 经过解析器后输出一个以 document 为顶层节点的树状结构的 DOM；
3. 样式计算：这里有 3 个步骤：
    1. 将 3 个来源（link 标签引入的外部样式、style 标签里定义的样式、以及元素的 style 属性上的样式）的 CSS 转化成浏览器能够理解的结构 styleSheets；
    2. 转换样式表中的属性值，使其标准化；比如 font-weight: bold; 会转成 font-weight: 700;、color: blue; 会转成 color: rgb(0, 0, 255); 等；
    3. 依据 CSS 的继承和层叠规则计算出 DOM 树中每个节点的具体样式；
4. 布局阶段：DOM 树中依然存在许多不可见的元素（比如 head），这些元素对于布局是丝毫没用的，所以又会生成一棵只包含可见元素的布局树；然后再根据布局树的每个节点计算出其具体位置和尺寸大小；
5. 分层：页面中有很多复杂的效果，如一些复杂的 3D 变换、页面滚动，或者使用 z-index 做 z 轴排序等，为了更加方便地实现这些效果，渲染引擎还需要为特定的节点生成专用的图层，并生成一棵对应的图层树；关于层叠上下文的知识，具体可以参考这里彻底搞懂CSS层叠上下文、层叠等级、层叠顺序、z-index；
6. 绘制：为每个图层生成绘制列表，并将其提交到合成线程；
7. 光栅化：通常一个页面很大，而视口很局限，所以合成线程会按照视口附近的图块来优先生成位图，并在光栅化线程池中将图块转换成位图；
8. 合成：一旦所有图块都被光栅化，合成线程就会生成一个绘制图块的命令 DrawQuad，然后将该命令提交给浏览器进程；之后浏览器将开始生成显示页面。

## TCP三次握手

## 关于很多TCP面试题的总结
[参考](https://www.nowcoder.com/discuss/530380?source_id=profile_create_nctrack&channel=-1)

## 拥塞控制

## http302，什么时候会用302，问我实际场景什么时候用302


## 问我502 答错了 我答成503了

## TCP握手 挥手

## 服务器server怎么把cookie设置到浏览器的
参考cyc2018基础知识面试中的cookie






## 然后问知道哪些http方法
[同上(HTTP中的请求方法)](./HTTP中的请求方法)

## 了解 HTTP 协议吗？
HTTP 是超文本传输协议，基于 TCP 协议。

## HTTP 协议的连接过程？

请求 TCP 连接
首先，浏览器与 Web 服务器的 HTTP 80端口建立一个 TCP 套接字连接。

发送 HTTP 请求

通过 TCP 连接，浏览器向服务器发送一个文本的请求报文，一个请求报文由请求行、请求头部、空行和请求数据组成。

接受请求返回响应

Web服务器解析请求，定位请求资源。服务器将资源复本写到 TCP 套接字，由浏览器读取。一个响应由状态行、响应头部、空行和响应数据组成。

释放TCP连接

若 connection 模式为 close，则服务器主动关闭TCP连接，客户端被动关闭连接，释放 TCP 连接

若connection 模式为 keepalive，则该连接会保持一段时间，在该时间内可以继续接收请求。

解析 HTML 内容

浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告知以下为若干字节的HTML文档和文档的字符集。客户端浏览器读取响应数据HTML，根据HTML的语法对其进行格式化，并在浏览器窗口中显示。

当时问到这个回答的很简略，一直准备了 HTTPS 的回答，没想到忽略了基础的 HTTP 协议。

## HTTP 协议的头部有哪些属性？
通用信息头
Request URL 请求的地址 域名
Request Method 请求的方法类型 GET / POST
Status Code 响应状态码 200 OK / 404 NOT-FOUND
Remote Address 表示远程服务器地址 IP地址
响应头
Content-Length 响应体的长度
Content-type 返回的响应MIME类型与编码:告诉浏览器它发送的数据属于什么文件类型
Cache-control 指定请求和响应遵循的缓存机制
public 响应可被任何缓存区缓存
private 对于单个用户的整个或部分响应消息，不能被共享缓存处理
no-cache 表示请求或响应消息不能缓存
请求头
Accept 告诉服务器可以接受的文件格式。
Accept-Encoding gzip等指定浏览器可以支持的web服务器返回的内容压缩编码类型。
Accept-Language 浏览器支持的语言。
Cache-Control 指定请求和响应遵循的缓存机制。
Connection keep-alive 表示是否需要持久连接。
Cookie HTTP请求发送时，会把保存在该请求域名下的所有 cookie 值一起发送给web服务器。
Host 指定请求的服务器的域名和端口号。
Referer 告诉服务器是从哪个网站链接过来的。
User-Agent 简称UA。内容包含发出请求的用户信息。
Authorization 当客户端访问受口令保护时，服务器端会发送401状态码和 www-authenticate 响应头，要求客户机使用 Authorization 来应答。
详细属性见文后附表。
一开始答的时候我竟然报了半天状态码还浑然不知，然后看见面试官一脸诧异的看着我才反应过来Orz。重新听了问题后还是没有答出来Orz。



Header	解释	示例
Accept-Ranges	表明服务器是否支持指定范围请求及哪种类型的分段请求	Accept-Ranges: bytes
Age	从原始服务器到代理缓存形成的估算时间（以秒计，非负）	Age: 12
Allow	对某网络资源的有效的请求行为，不允许则返回405	Allow: GET, HEAD
Cache-Control	告诉所有的缓存机制是否可以缓存及哪种类型	Cache-Control: no-cache
Content-Encoding	web服务器支持的返回内容压缩编码类型。	Content-Encoding: gzip
Content-Language	响应体的语言	Content-Language: en,zh
Content-Length	响应体的长度	Content-Length: 348
Content-Location	请求资源可替代的备用的另一地址	Content-Location: /index.htm
Content-MD5	返回资源的MD5校验值	Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==
Content-Range	在整个返回体中本部分的字节位置	Content-Range: bytes 21010-47021/47022
Content-Type	返回内容的MIME类型	Content-Type: text/html; charset=utf-8
Date	原始服务器消息发出的时间	Date: Tue, 01 Nov 2020 08:12:31 GMT
ETag	请求变量的实体标签的当前值	ETag: “737060cd8c284d8af7ad3082f209582d”
Expires	响应过期的日期和时间	Expires: Thu, 01 Dec 2010 16:00:00 GMT
Last-Modified	请求资源的最后修改时间	Last-Modified: Tue, 01 Nov 2020 12:00:00 GMT
Location	用来重定向接收方到非请求URL的位置来完成请求或标识新的资源	Location: http://www.xxx.com/xxx.html
Pragma	包括实现特定的指令，它可应用到响应链上的任何接收方	Pragma: no-cache
Proxy-Authenticate	它指出认证方案和可应用到代理的该URL上的参数	Proxy-Authenticate: Basic
refresh	应用于重定向或一个新的资源被创造，在5秒之后重定向（由网景提出，被大部分浏览器支持）	Refresh: 5; url=http://www.xxx.com/xxx.html
Retry-After	如果实体暂时不可取，通知客户端在指定时间之后再次尝试	Retry-After: 120
Server	web服务器软件名称	Server: Apache/1.3.27 (Unix) (Red-Hat/Linux)
Set-Cookie	设置Http Cookie	Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1
Trailer	指出头域在分块传输编码的尾部存在	Trailer: Max-Forwards
Transfer-Encoding	文件传输编码	Transfer-Encoding:chunked
Vary	告诉下游代理是使用缓存响应还是从原始服务器请求	Vary: *
Via	告知代理客户端响应是通过哪里发送的	Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)
Warning	警告实体可能存在的问题	Warning: 199 Miscellaneous warning
WWW-Authenticate	表明客户端请求实体应该使用的授权方案	WWW-Authenticate: Basic

## DNS 是什么？DNS 的查询过程？
DNS 是域名系统，通常用来解析域名为 IP 地址。
本地解析 通过本地缓存进行解析。
直接解析 向客户机所设定的局部 DNS 服务器发一个查询请求。
递归解析 局部 DNS 服务器向该域名的根域服务器查询，再由根域名服务器一级级向下查询。
迭代解析 局部 DNS 服务器把请求转发至上一级 DNS 服务器，再请求上上级直到查询到该域名。
当时只回答了递归解析和迭代解析，其实还有 Host 文件、本地和直接解析