# Mysql

!> mysql面试题
[参考](https://zhuanlan.zhihu.com/p/140876416)

重点：事务，隔离级别，锁，索引，存储引擎

------------
## 事务
> 在 MySQL 中，事务支持是在引擎层实现的
> MySQL 是一个支持多引擎的系统，但并不 是所有的引擎都支持事务。比如 MySQL 原生的 MyISAM 引擎就不支持事务，这也是 MyISAM 被 InnoDB 取代的重要原因之一
1. 参考：极客时间课程mysql实战45讲
2. 参考：https://zhuanlan.zhihu.com/p/85990712
3. 参考：https://blog.csdn.net/sanyuesan0000/article/details/90235335
4. 参考：https://www.cnblogs.com/chenglc/p/10912340.html
### 事务是什么
事务是一个不可分割的数据库操作序列，也是数据库并发控制的基本单位，其执行的结果必须使数据库从一种一致性状态变到另一种一致性状态。事务是逻辑上的一组操作，要么都执行，要么都不执行。

### 事务的特点或特性
> 类似问题： 数据库用的是什么？说说数据库事务的特性。
> 类似问题：ACID 是什么？具体介绍一下。

!> ACID：分别对应原子性atomicity，一致性consistency，隔离性isolation，持久性durability
1. **原子性**，是指一个事务操作不可分割，要么成功，要么失败，不能有一半成功一半失败的情况。
2. **一致性**：是指这些数据在事务执行完成这个时间点之前，读到的一定是更新前的数据，之后读到的一定是更新后的数据，不应该存在一个时刻，让用户读到更新过程中的数据。
3. **隔离性**：是指一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对正在进行的其他事务是隔离的，并发执行的各个事务之间不能互相干扰，这个有点儿像我们打网游中的副本，我们在副本中打的怪和掉的装备，与其他副本没有任何关联也不会互相影响。
4. **持久性**：一个事务被提交之后。它对数据库中数据的改变是持久的，后续的其他操作和故障都不会对事务的结果产生任何影响

### 事务隔离级别，对应的问题

> 类似问题：事务的隔离级别
> 类似问题：mysql 隔离级别
> 类似问题：mysql 的事务隔离级别有几种啊

越往下效率越低
1. 读未提交（read uncommitted）：一个事务还没提交时，它做的变更就能被别的事务看到。**出现的问题：脏读，不可重复读，幻读**
2. 读提交（read committed，简称RC）：一个事务提交之后，它做的变更才会被其他事务看到。**出现的问题：不可重复读，幻读**
3. 可重复读（repeatable read，简称RR）：一个事务执行过程中看到的数据，总是跟这个事务在启动时看到的数据是 一致的。当然在可重复读隔离级别下，未提交变更对其他事务也是不可见的。**出现的问题：幻读**
4. 串行化 （serializable ）：顾名思义是对于同一行记录，“写”会加“写锁”，“读”会加“读锁”。当出 现读写锁冲突的时候，后访问的事务必须等前一个事务执行完成，才能继续执行。

1. 脏读(Drity Read)：某个事务已更新一份数据，另一个事务在此时读取了同一份数据，由于某些原因，前一个RollBack了操作，则后一个事务所读取的数据就会是不正确的。
2. 不可重复读(Non-repeatable read):在一个事务的两次查询之中数据不一致，这可能是两次查询过程中间插入了一个事务更新的原有的数据。
3. 幻读(Phantom Read):在一个事务的两次查询中数据笔数不一致，例如有一个事务查询了几列(Row)数据，而另一个事务却在此时插入了新的几列数据，先前的事务在接下来的查询中，就会发现有几列数据是它先前所没有的。

理解：SQL 标准定义了四个隔离级别：READ-UNCOMMITTED(读取未提交)： 最低的隔离级别，允许读取尚未提交的数据变更，可能会导致脏读、幻读或不可重复读。READ-COMMITTED(读取已提交)： 允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生。REPEATABLE-READ(可重复读)： 对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。SERIALIZABLE(可串行化)： 最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。

**mysql中默认使用可重读，oracle中默认使用读已提交**

### 事务的隔离有哪些,说一下每个隔离的区别,mysql默认使用哪个隔离,日常应用中应该使用已提交读还是可重复读

### 提交读和可重复读的实现原理
> 以下答案来自于极客时间的mysql实战45讲
在实现上，数据库里面会创建一个视图，访问的时候以视图的逻辑结果为准。在“可重复 读”隔离级别下，这个视图是在事务启动时创建的，整个事务存在期间都用这个视图。 在“读提交”隔离级别下，这个视图是在每个 SQL 语句开始执行的时候创建的。“读未提交”隔离级别下直接返回记录上的最新值，没有视图概念；而“串行 化”隔离级别下直接用加锁的方式来避免并行访问。

### 事务的实现

如何实现参考极客时间课程mysql实战45讲与https://blog.csdn.net/sanyuesan0000/article/details/90235335

### 事务的几个特性 2次 事务的特性以及对应的问题，如何保证的

### mysql事务的隔离级别以及分别如何实现？
级别：
    读未提交
    读已提交
    可重复读
    串行化
实现：MVVC机制以及undo_log


如何实现参考极客时间课程mysql实战45讲与https://blog.csdn.net/sanyuesan0000/article/details/90235335

> 类似问题： 如何实现事务 我就回答了MVCC + 一顿猛吹
### mysql 的事务锁了解吗

### 那每一个事务隔离级别分别解决了什么问题呢
读未提交：出现脏读，不可重读，幻读问题
读已提交：解决脏读问题，出现不可重读，幻读问题
可重读：出现幻读问题，解决脏读，不可重读
序列化：解决脏读，不可重读，幻读问题
### 那可重复读能解决什么
同上一个问题

### 讲讲可重复读隔离级别


如何实现参考极客时间课程mysql实战45讲与https://blog.csdn.net/sanyuesan0000/article/details/90235335


------------
## 索引
### 索引的结构以及概念
1. 索引是一种特殊的文件(InnoDB数据表上的索引是表空间的一个组成部分)，它们包含着对数据表里所有记录的引用指针。
2. 索引是一种数据结构。数据库索引，是数据库管理系统中一个排序的数据结构，以协助快速查询、更新数据库表中数据。索引的实现通常使用B数及其变种B+数。
3. 更通俗的说，索引就相当于目录。为了方便查找书中的内容，通过对内容建立索引形成目录。索引是一个文件，它是要占据物理空间的。

### mysql索引的数据结构以及分类(B+树以及和B-树，红黑树，二叉树的优缺点，聚簇索引，非聚簇索引，hash索引的优缺点以及实现)

> 类似问题：mysql索引结构。


索引的数据结构和具体存储引擎的实现有关，在MySQL中使用较多的索引有Hash索引，B+树索引等，而我们经常使用的InnoDB存储引擎的默认索引实现为：B+树索引。对于哈希索引来说，底层的数据结构就是哈希表，因此在绝大多数需求为单条记录查询的时候，可以选择哈希索引，查询性能最快；其余大部分场景，建议选择BTree索引。

1. B树索引
mysql通过存储引擎取数据，基本上90%的人用的就是InnoDB了，按照实现方式分，InnoDB的索引类型目前只有两种：BTREE（B树）索引和HASH索引。B树索引是Mysql数据库中使用最频繁的索引类型，基本所有存储引擎都支持BTree索引。通常我们说的索引不出意外指的就是（B树）索引（实际是用B+树实现的，因为在查看表索引时，mysql一律打印BTREE，所以简称为B树索引）

2. B+tree性质
n棵子tree的节点包含n个关键字，不用来保存数据而是保存数据的索引。
所有的叶子结点中包含了全部关键字的信息，即指向含这些关键字记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接。
所有的非终端结点可以看成是索引部分，结点中仅含其子数中的最大（或最小）关键字。
B+ 树中，数据对象的插入和删除仅在叶节点上进行。
B+树有2个头指针，一个是树的根节点，一个是最小关键码的叶节点。

3. 哈希索引
简要说下，类似于数据结构中简单实现的HASH表（散列表）一样，当我们在mysql中用哈希索引时，主要就是通过Hash算法（常见的Hash算法有直接定址法、平方取中法、折叠法、除数取余法、随机数法），将数据库字段数据转换成定长的Hash值，与这条数据的行指针一并存入Hash表的对应位置；如果发生Hash碰撞（两个不同关键字的Hash值相同），则在对应Hash键下以链表形式存储。当然这只是简略模拟图。



### 数据库中数据很多的时候如何处理？面试官提示了索引
### 索引越多越好么？
通常，通过索引查询数据比全表扫描要快。但是我们也必须注意到它的代价。
索引需要空间来存储，也需要定期维护， 每当有记录在表中增减或索引列被修改时，索引本身也会被修改。 这意味着每条记录的INSERT，DELETE，UPDATE将为此多付出4，5 次的磁盘I/O。 因为索引需要额外的存储空间和处理，那些不必要的索引反而会使查询反应时间变慢。使用索引查询不一定能提高查询性能，索引范围查询(INDEX RANGE SCAN)适用于两种情况:

基于一个范围的检索，一般查询返回结果集小于表中记录数的30%
基于非唯一性索引的检索

### B+树有什么好处
> 参考：https://zhuanlan.zhihu.com/p/140876416
由于B+树的内部节点只存放键，不存放值，因此，一次读取，可以在内存页中获取更多的键，有利于更快地缩小查找范围。 B+树的叶节点由一条链相连，因此，当需要进行一次全数据遍历的时候，B+树只需要使用O(logN)时间找到最小的一个节点，然后通过链进行O(N)的顺序遍历即可。而B树则需要对树的每一层进行遍历，这会需要更多的内存置换次数，因此也就需要花费更多的时间

### 二叉树，b 树，b+树的区别
### InnoDB二级索引流程
### 主键和索引的区别
### mysql索引类型有哪些
### b+树的特性，为啥要用到这
### 如何提高索引的速度
### B+ Tree
### innodb的索引有哪些
### 数据库使用b+树的好处
### 联合索引的使用原则
### 如何创建索引
### 数据库的索引
### mysql索引
### mysql 索引慢分析（线上开启slowlog，提取慢查询，然后仔细分析explain 中 tye字段以及extra字段，发生的具体场景及mysql是怎么做的，被表扬回答的不错）
### 数据库索引结构是什么样的
我回答B+树，然后问对磁盘有什么优势
夺命追问，我说降低IO次数，问为什么
### B+树的特点
### mysql 索引 2次
### 了解Mysql中的索引：涉及到什么是B树，与二叉搜索树和平衡二叉树区别，以及B+树区别
二叉排序树(Binary Sort Tree)，又称为二叉查找树，它或者是一颗空树，或者是具有下列性质的二叉树：
1. 若它的左子树不为空，则左子树上所有节点的值均小于它的根节点的值
2. 若它的右子树不为空，则右子树上所有节点的值均大于它的根节点的值
3. 它的左右子树也分别为二叉排序树

平衡二叉树(self-Balancing Binary Search Tree，也叫做AVL树)，是一种二叉排序树，其中每一个节点的左右子树的高度差至多等于1
前提首先是一颗二叉排序树，而后需要保持平衡特性所以就叫做平衡二叉树。

2-3树是这样的一颗多路查找树，其中每一个节点都具有两个孩子(我们称为2节点)或三个孩子(我们称为3节点)

一个2节点包含一个元素和两个孩子(或没有孩子)，且与二叉排序树类似，左子树包含的元素小于该元素，右子树包含的元素大于该元素，不过与二叉排序树不同的是，这个2节点要么没有孩子，要么就有两个，不能只有一个孩子。

一个3节点包含一小一大两个元素和三个孩子（或没有孩子），一个3节点要么没有孩子，要么具有3个孩子，如果某个3节点有孩子的话，左子树包含小于较小元素的元素，右子树包含大于较大元素的元素，中间元素包含介于两元素之间的元素。

2-3-4树包含了4节点的使用，一个4节点包含小中大三个元素和四个孩子(或没有孩子)，一个4节点要么没有孩子，要么具有4个孩子，如果某个4节点有孩子的话，左子树包含小于最小元素的元素，第二子树包含大于最小元素、小于第二元素的元素，第三子树包含大于第二元素，小于最大元素的元素，右子树包含大于最大元素的元素

B树是一种平衡的多路查找树，2-3树与2-3-4树都是B树的特例，节点最大的孩子数目称为B树的阶。因此，2-3树是3阶B树，2-3-4树是4阶B树
![IMG_0379](https://cdn.jsdelivr.net/gh/sivanWu0222/ImageHosting@master/uPic/IMG_0379.jpg)

B+树参照《大话数据结构》P352


### 数据库的索引

### 数据库覆盖索引

### 数据库聚集索引和辅助索引


### MySQL 的索引
后面的问题：为什么用 b+树
b 和 b+区别

### 谈谈索引的数据结构？说了 B+树

### B+树和 B-树的区别以及优点？

### 为什么不用搜索树？


------------
## 锁
### mysql的锁类型
[参考](https://blog.csdn.net/qq_34337272/article/details/80611486)
### 行锁什么时候变表锁
### select语句什么时候行锁什么时候变表锁
### mysql的锁
### 用什么语句实现数据库锁
### innodb的一些特性，和Myisam的，行锁表锁

------------
## 存储引擎
### innodb的一些特性，和Myisam的，行锁表锁
### mysql中innodb引擎
### 知道哪些存储引擎
### 存储引擎在MySQL这个系统架构的哪个位置
### innodb与myisam的区别

### mysql的存储引擎
------------

## 设计
### 数据表设计遵循的原则

### 数据库三大范式
1. 第一范式：每个列都不可以再拆分。
2. 第二范式：在第一范式的基础上，非主键列完全依赖于主键，而不能是依赖于主键的一部分。
3. 第三范式：在第二范式的基础上，非主键列只依赖于主键，不依赖于其他非主键。
在设计数据库结构的时候，要尽量遵守三范式，如果不遵守，必须有足够的理由。比如性能。事实上我们经常会为了性能而妥协数据库的设计。
### 一范式为什么要列不可分割

### 设计学生成绩系统，如何建表，如何建索引
### 数据库表是如何设计的

------------

## 其他问题

### 数据库完整性的实现
### 主键
### 介绍mysql
### 数据库中有两个关联列，请问在搜索时，这两个关联列会怎样？
### Mysql怎么去查询的，什么时候走索引，什么时候不走
### Mysql了解什么，有没有搭过mysql、redis
### 数据库的部署怎么做
### 读写分离具体怎么做
### 数据库优化+缓存（缓存的不一致，binlog解析器），读写分离，分库分表
### mysql怎么存储时间
### mysql把邮戳转化为日常格式时间的函数
### sql慢查询
### 如果一个表查询，插入等很慢，你怎么做？
### mysql 分布式id（项目用到的）
### sql语句：查询所有课程分数都大于或等于80分的学生姓名
### 写个sql语句，两张表，学生表，学生课程表，求平均分大于85的学生的姓名
### sql语句：表【学生|科目|成绩】查询每个学生成绩最好的科目和成绩 ( 没完全写出来


### mysql 和 mongodb 的区别，什么时候用 mysql，什么时候用 mongo（因为简历上 有写 mongodb）



### 给定一张表 user(id,name,age)

有这样一个查询

select id,name,age where name=....

如何建立索引，并且使用到覆盖索引

### 一个教务系统，包括学生信息，课程信息，考试安排，成绩查询，绩点分析，你来设 计数据库表应该怎么设计？

用你刚刚设计的表来给我查询出全校所有高数在 85 分一以上的人的名字


### char 和 varchar

SQL：userId(主播 Id) de..Id(设备 Id)，怎么实现对主播与主播之间的重合数（共同关注

数）

### SQL，一个表 User，字段 userid，username，city 查询用户数量最多的三个城市。

### MySQL 的自增主键和随机生成主键的区别，为什么自增主键效率高。

### 如何查看数据库表结构？

### 如何提高 SQL 查询效率，在语句方面上的优化？